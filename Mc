#             â–ˆ â–ˆ â–€ â–ˆâ–„â–€ â–„â–€â–ˆ â–ˆâ–€â–ˆ â–€
#             â–ˆâ–€â–ˆ â–ˆ â–ˆ â–ˆ â–ˆâ–€â–ˆ â–ˆâ–€â–„ â–ˆ
#              Â© Copyright 2022
#           https://t.me/hikariatama
#
# ğŸ”’ Licensed under the GNU AGPLv3
# ğŸŒ https://www.gnu.org/licenses/agpl-3.0.html

# scope: hikka_min 1.3.0

from .. import loader, utils
from telethon.tl.types import ChatBannedRights
from telethon.tl.functions.messages import EditChatDefaultBannedRightsRequest


@loader.tds
class MuteChatMod(loader.Module):
    """ĞœÑƒÑ‚ Ñ‡Ğ°Ñ‚Ğ°."""

    strings = {"name": "MuteChat"}

    async def mccmd(self, message):
        """Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼ÑƒÑ‚ Ñ‡Ğ°Ñ‚Ğ°."""
        if utils.get_args_raw(message) == "clearall":
            self.set("mc", [])
            await utils.answer(message, "âœ… <b>ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ Ğ²Ğ¾ Ğ²ÑĞµÑ… Ñ‡Ğ°Ñ‚Ğ°Ñ…!</b>")
            return

        if message.is_private:
            await utils.answer(message, "ğŸš« <b>Ğ­Ñ‚Ğ¾ Ğ½Ğµ Ñ‡Ğ°Ñ‚!</b>")
            return

        chat = await message.get_chat()
        if not chat.admin_rights and not chat.creator:
            await utils.answer(message, "ğŸš« <b>ĞĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°!</b>")
            return

        if chat.admin_rights.ban_users == False:
            await utils.answer(message, "ğŸš« <b>ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¿Ñ€Ğ°Ğ²!</b>")
            return

        mc = self.get("mc", [])
        chatid = utils.get_chat_id(message)
        if chatid in mc:
            await self._client(
                EditChatDefaultBannedRightsRequest(
                    message.peer_id,
                    ChatBannedRights(until_date=None, send_messages=None),
                )
            )
            mc.remove(chatid)
            self.set("mc", mc)
            await utils.answer(message, "ğŸ”ˆ <b>Ğ§Ğ°Ñ‚ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚!</b>")
        else:
            await self._client(
                EditChatDefaultBannedRightsRequest(
                    message.peer_id, ChatBannedRights(until_date=0, send_messages=True)
                )
            )
            mc.append(chatid)
            self.set("mc", mc)
            await utils.answer(message, "ğŸ”‡ <b>Ğ§Ğ°Ñ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚!</b>")
